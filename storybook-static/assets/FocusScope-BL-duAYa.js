import{V as q,J as P,R as B,i as x,W as m,N as w,X as G,Y as J,x as Y,K as g,B as j,Z as X,d as Z}from"./useFocusRing-CRLlfMnZ.js";import{r as $,R as y}from"./iframe-DcsACL-T.js";class Q{get currentNode(){return this._currentNode}set currentNode(e){if(!P(this.root,e))throw new Error("Cannot set currentNode to a node that is not contained by the root node.");const r=[];let n=e,o=e;for(this._currentNode=e;n&&n!==this.root;)if(n.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const l=n,i=this._doc.createTreeWalker(l,this.whatToShow,{acceptNode:this._acceptNode});r.push(i),i.currentNode=o,this._currentSetFor.add(i),n=o=l.host}else n=n.parentNode;const a=this._doc.createTreeWalker(this.root,this.whatToShow,{acceptNode:this._acceptNode});r.push(a),a.currentNode=o,this._currentSetFor.add(a),this._walkerStack=r}get doc(){return this._doc}firstChild(){let e=this.currentNode,r=this.nextNode();return P(e,r)?(r&&(this.currentNode=r),r):(this.currentNode=e,null)}lastChild(){let r=this._walkerStack[0].lastChild();return r&&(this.currentNode=r),r}nextNode(){const e=this._walkerStack[0].nextNode();if(e){if(e.shadowRoot){var r;let o;if(typeof this.filter=="function"?o=this.filter(e):!((r=this.filter)===null||r===void 0)&&r.acceptNode&&(o=this.filter.acceptNode(e)),o===NodeFilter.FILTER_ACCEPT)return this.currentNode=e,e;let a=this.nextNode();return a&&(this.currentNode=a),a}return e&&(this.currentNode=e),e}else if(this._walkerStack.length>1){this._walkerStack.shift();let n=this.nextNode();return n&&(this.currentNode=n),n}else return null}previousNode(){const e=this._walkerStack[0];if(e.currentNode===e.root){if(this._currentSetFor.has(e))if(this._currentSetFor.delete(e),this._walkerStack.length>1){this._walkerStack.shift();let o=this.previousNode();return o&&(this.currentNode=o),o}else return null;return null}const r=e.previousNode();if(r){if(r.shadowRoot){var n;let a;if(typeof this.filter=="function"?a=this.filter(r):!((n=this.filter)===null||n===void 0)&&n.acceptNode&&(a=this.filter.acceptNode(r)),a===NodeFilter.FILTER_ACCEPT)return r&&(this.currentNode=r),r;let l=this.lastChild();return l&&(this.currentNode=l),l}return r&&(this.currentNode=r),r}else if(this._walkerStack.length>1){this._walkerStack.shift();let o=this.previousNode();return o&&(this.currentNode=o),o}else return null}nextSibling(){return null}previousSibling(){return null}parentNode(){return null}constructor(e,r,n,o){this._walkerStack=[],this._currentSetFor=new Set,this._acceptNode=l=>{if(l.nodeType===Node.ELEMENT_NODE){const f=l.shadowRoot;if(f){const u=this._doc.createTreeWalker(f,this.whatToShow,{acceptNode:this._acceptNode});return this._walkerStack.unshift(u),NodeFilter.FILTER_ACCEPT}else{var i;if(typeof this.filter=="function")return this.filter(l);if(!((i=this.filter)===null||i===void 0)&&i.acceptNode)return this.filter.acceptNode(l);if(this.filter===null)return NodeFilter.FILTER_ACCEPT}}return NodeFilter.FILTER_SKIP},this._doc=e,this.root=r,this.filter=o??null,this.whatToShow=n??NodeFilter.SHOW_ALL,this._currentNode=r,this._walkerStack.unshift(e.createTreeWalker(r,n,this._acceptNode));const a=r.shadowRoot;if(a){const l=this._doc.createTreeWalker(a,this.whatToShow,{acceptNode:this._acceptNode});this._walkerStack.unshift(l)}}}function O(t,e,r,n){return q()?new Q(t,e,r,n):t.createTreeWalker(e,r,n)}function ee(t){const e=B(t);if(!(t instanceof e.HTMLElement)&&!(t instanceof e.SVGElement))return!1;let{display:r,visibility:n}=t.style,o=r!=="none"&&n!=="hidden"&&n!=="collapse";if(o){const{getComputedStyle:a}=t.ownerDocument.defaultView;let{display:l,visibility:i}=a(t);o=l!=="none"&&i!=="hidden"&&i!=="collapse"}return o}function te(t,e){return!t.hasAttribute("hidden")&&!t.hasAttribute("data-react-aria-prevent-focus")&&(t.nodeName==="DETAILS"&&e&&e.nodeName!=="SUMMARY"?t.hasAttribute("open"):!0)}function z(t,e){return t.nodeName!=="#comment"&&ee(t)&&te(t,e)&&(!t.parentElement||z(t.parentElement,t))}const M=y.createContext(null),A="react-aria-focus-scope-restore";let h=null;function ce(t){let{children:e,contain:r,restoreFocus:n,autoFocus:o}=t,a=$.useRef(null),l=$.useRef(null),i=$.useRef([]),{parentNode:f}=$.useContext(M)||{},u=$.useMemo(()=>new I({scopeRef:i}),[i]);x(()=>{let s=f||N.root;if(N.getTreeNode(s.scopeRef)&&h&&!F(h,s.scopeRef)){let b=N.getTreeNode(h);b&&(s=b)}s.addChild(u),N.addNode(u)},[u,f]),x(()=>{let s=N.getTreeNode(i);s&&(s.contain=!!r)},[r]),x(()=>{var s;let b=(s=a.current)===null||s===void 0?void 0:s.nextSibling,v=[],_=C=>C.stopPropagation();for(;b&&b!==l.current;)v.push(b),b.addEventListener(A,_),b=b.nextSibling;return i.current=v,()=>{for(let C of v)C.removeEventListener(A,_)}},[e]),ie(i,n,r),ne(i,r),ae(i,n,r),oe(i,o),$.useEffect(()=>{const s=m(w(i.current?i.current[0]:void 0));let b=null;if(T(s,i.current)){for(let v of N.traverse())v.scopeRef&&T(s,v.scopeRef.current)&&(b=v);b===N.getTreeNode(i)&&(h=b.scopeRef)}},[i]),x(()=>()=>{var s,b,v;let _=(v=(b=N.getTreeNode(i))===null||b===void 0||(s=b.parent)===null||s===void 0?void 0:s.scopeRef)!==null&&v!==void 0?v:null;(i===h||F(i,h))&&(!_||N.getTreeNode(_))&&(h=_),N.removeTreeNode(i)},[i]);let d=$.useMemo(()=>re(i),[]),c=$.useMemo(()=>({focusManager:d,parentNode:u}),[u,d]);return y.createElement(M.Provider,{value:c},y.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:a}),e,y.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:l}))}function de(){var t;return(t=$.useContext(M))===null||t===void 0?void 0:t.focusManager}function re(t){return{focusNext(e={}){let r=t.current,{from:n,tabbable:o,wrap:a,accept:l}=e;var i;let f=n||m(w((i=r[0])!==null&&i!==void 0?i:void 0)),u=r[0].previousElementSibling,d=S(r),c=E(d,{tabbable:o,accept:l},r);c.currentNode=T(f,r)?f:u;let s=c.nextNode();return!s&&a&&(c.currentNode=u,s=c.nextNode()),s&&p(s,!0),s},focusPrevious(e={}){let r=t.current,{from:n,tabbable:o,wrap:a,accept:l}=e;var i;let f=n||m(w((i=r[0])!==null&&i!==void 0?i:void 0)),u=r[r.length-1].nextElementSibling,d=S(r),c=E(d,{tabbable:o,accept:l},r);c.currentNode=T(f,r)?f:u;let s=c.previousNode();return!s&&a&&(c.currentNode=u,s=c.previousNode()),s&&p(s,!0),s},focusFirst(e={}){let r=t.current,{tabbable:n,accept:o}=e,a=S(r),l=E(a,{tabbable:n,accept:o},r);l.currentNode=r[0].previousElementSibling;let i=l.nextNode();return i&&p(i,!0),i},focusLast(e={}){let r=t.current,{tabbable:n,accept:o}=e,a=S(r),l=E(a,{tabbable:n,accept:o},r);l.currentNode=r[r.length-1].nextElementSibling;let i=l.previousNode();return i&&p(i,!0),i}}}function S(t){return t[0].parentElement}function R(t){let e=N.getTreeNode(h);for(;e&&e.scopeRef!==t;){if(e.contain)return!1;e=e.parent}return!0}function ne(t,e){let r=$.useRef(void 0),n=$.useRef(void 0);x(()=>{let o=t.current;if(!e){n.current&&(cancelAnimationFrame(n.current),n.current=void 0);return}const a=w(o?o[0]:void 0);let l=u=>{if(u.key!=="Tab"||u.altKey||u.ctrlKey||u.metaKey||!R(t)||u.isComposing)return;let d=m(a),c=t.current;if(!c||!T(d,c))return;let s=S(c),b=E(s,{tabbable:!0},c);if(!d)return;b.currentNode=d;let v=u.shiftKey?b.previousNode():b.nextNode();v||(b.currentNode=u.shiftKey?c[c.length-1].nextElementSibling:c[0].previousElementSibling,v=u.shiftKey?b.previousNode():b.nextNode()),u.preventDefault(),v&&p(v,!0)},i=u=>{(!h||F(h,t))&&T(g(u),t.current)?(h=t,r.current=g(u)):R(t)&&!k(g(u),t)?r.current?r.current.focus():h&&h.current&&D(h.current):R(t)&&(r.current=g(u))},f=u=>{n.current&&cancelAnimationFrame(n.current),n.current=requestAnimationFrame(()=>{let d=Z(),c=(d==="virtual"||d===null)&&j()&&X(),s=m(a);if(!c&&s&&R(t)&&!k(s,t)){h=t;let v=g(u);if(v&&v.isConnected){var b;r.current=v,(b=r.current)===null||b===void 0||b.focus()}else h.current&&D(h.current)}})};return a.addEventListener("keydown",l,!1),a.addEventListener("focusin",i,!1),o?.forEach(u=>u.addEventListener("focusin",i,!1)),o?.forEach(u=>u.addEventListener("focusout",f,!1)),()=>{a.removeEventListener("keydown",l,!1),a.removeEventListener("focusin",i,!1),o?.forEach(u=>u.removeEventListener("focusin",i,!1)),o?.forEach(u=>u.removeEventListener("focusout",f,!1))}},[t,e]),x(()=>()=>{n.current&&cancelAnimationFrame(n.current)},[n])}function H(t){return k(t)}function T(t,e){return!t||!e?!1:e.some(r=>r.contains(t))}function k(t,e=null){if(t instanceof Element&&t.closest("[data-react-aria-top-layer]"))return!0;for(let{scopeRef:r}of N.traverse(N.getTreeNode(e)))if(r&&T(t,r.current))return!0;return!1}function se(t){return k(t,h)}function F(t,e){var r;let n=(r=N.getTreeNode(e))===null||r===void 0?void 0:r.parent;for(;n;){if(n.scopeRef===t)return!0;n=n.parent}return!1}function p(t,e=!1){if(t!=null&&!e)try{Y(t)}catch{}else if(t!=null)try{t.focus()}catch{}}function U(t,e=!0){let r=t[0].previousElementSibling,n=S(t),o=E(n,{tabbable:e},t);o.currentNode=r;let a=o.nextNode();return e&&!a&&(n=S(t),o=E(n,{tabbable:!1},t),o.currentNode=r,a=o.nextNode()),a}function D(t,e=!0){p(U(t,e))}function oe(t,e){const r=y.useRef(e);$.useEffect(()=>{if(r.current){h=t;const n=w(t.current?t.current[0]:void 0);!T(m(n),h.current)&&t.current&&D(t.current)}r.current=!1},[t])}function ie(t,e,r){x(()=>{if(e||r)return;let n=t.current;const o=w(n?n[0]:void 0);let a=l=>{let i=g(l);T(i,t.current)?h=t:H(i)||(h=null)};return o.addEventListener("focusin",a,!1),n?.forEach(l=>l.addEventListener("focusin",a,!1)),()=>{o.removeEventListener("focusin",a,!1),n?.forEach(l=>l.removeEventListener("focusin",a,!1))}},[t,e,r])}function W(t){let e=N.getTreeNode(h);for(;e&&e.scopeRef!==t;){if(e.nodeToRestore)return!1;e=e.parent}return e?.scopeRef===t}function ae(t,e,r){const n=$.useRef(typeof document<"u"?m(w(t.current?t.current[0]:void 0)):null);x(()=>{let o=t.current;const a=w(o?o[0]:void 0);if(!e||r)return;let l=()=>{(!h||F(h,t))&&T(m(a),t.current)&&(h=t)};return a.addEventListener("focusin",l,!1),o?.forEach(i=>i.addEventListener("focusin",l,!1)),()=>{a.removeEventListener("focusin",l,!1),o?.forEach(i=>i.removeEventListener("focusin",l,!1))}},[t,r]),x(()=>{const o=w(t.current?t.current[0]:void 0);if(!e)return;let a=l=>{if(l.key!=="Tab"||l.altKey||l.ctrlKey||l.metaKey||!R(t)||l.isComposing)return;let i=o.activeElement;if(!k(i,t)||!W(t))return;let f=N.getTreeNode(t);if(!f)return;let u=f.nodeToRestore,d=E(o.body,{tabbable:!0});d.currentNode=i;let c=l.shiftKey?d.previousNode():d.nextNode();if((!u||!u.isConnected||u===o.body)&&(u=void 0,f.nodeToRestore=void 0),(!c||!k(c,t))&&u){d.currentNode=u;do c=l.shiftKey?d.previousNode():d.nextNode();while(k(c,t));l.preventDefault(),l.stopPropagation(),c?p(c,!0):H(u)?p(u,!0):i.blur()}};return r||o.addEventListener("keydown",a,!0),()=>{r||o.removeEventListener("keydown",a,!0)}},[t,e,r]),x(()=>{const o=w(t.current?t.current[0]:void 0);if(!e)return;let a=N.getTreeNode(t);if(a){var l;return a.nodeToRestore=(l=n.current)!==null&&l!==void 0?l:void 0,()=>{let i=N.getTreeNode(t);if(!i)return;let f=i.nodeToRestore,u=m(o);if(e&&f&&(u&&k(u,t)||u===o.body&&W(t))){let d=N.clone();requestAnimationFrame(()=>{if(o.activeElement===o.body){let c=d.getTreeNode(t);for(;c;){if(c.nodeToRestore&&c.nodeToRestore.isConnected){V(c.nodeToRestore);return}c=c.parent}for(c=d.getTreeNode(t);c;){if(c.scopeRef&&c.scopeRef.current&&N.getTreeNode(c.scopeRef)){let s=U(c.scopeRef.current,!0);V(s);return}c=c.parent}}})}}}},[t,e])}function V(t){t.dispatchEvent(new CustomEvent(A,{bubbles:!0,cancelable:!0}))&&p(t)}function E(t,e,r){let n=e?.tabbable?G:J,o=t?.nodeType===Node.ELEMENT_NODE?t:null,a=w(o),l=O(a,t||a,NodeFilter.SHOW_ELEMENT,{acceptNode(i){var f;return!(e==null||(f=e.from)===null||f===void 0)&&f.contains(i)?NodeFilter.FILTER_REJECT:n(i)&&z(i)&&(!r||T(i,r))&&(!e?.accept||e.accept(i))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return e?.from&&(l.currentNode=e.from),l}function fe(t,e={}){return{focusNext(r={}){let n=t.current;if(!n)return null;let{from:o,tabbable:a=e.tabbable,wrap:l=e.wrap,accept:i=e.accept}=r,f=o||m(w(n)),u=E(n,{tabbable:a,accept:i});n.contains(f)&&(u.currentNode=f);let d=u.nextNode();return!d&&l&&(u.currentNode=n,d=u.nextNode()),d&&p(d,!0),d},focusPrevious(r=e){let n=t.current;if(!n)return null;let{from:o,tabbable:a=e.tabbable,wrap:l=e.wrap,accept:i=e.accept}=r,f=o||m(w(n)),u=E(n,{tabbable:a,accept:i});if(n.contains(f))u.currentNode=f;else{let c=L(u);return c&&p(c,!0),c??null}let d=u.previousNode();if(!d&&l){u.currentNode=n;let c=L(u);if(!c)return null;d=c}return d&&p(d,!0),d??null},focusFirst(r=e){let n=t.current;if(!n)return null;let{tabbable:o=e.tabbable,accept:a=e.accept}=r,i=E(n,{tabbable:o,accept:a}).nextNode();return i&&p(i,!0),i},focusLast(r=e){let n=t.current;if(!n)return null;let{tabbable:o=e.tabbable,accept:a=e.accept}=r,l=E(n,{tabbable:o,accept:a}),i=L(l);return i&&p(i,!0),i??null}}}function L(t){let e,r;do r=t.lastChild(),r&&(e=r);while(r);return e}class K{get size(){return this.fastMap.size}getTreeNode(e){return this.fastMap.get(e)}addTreeNode(e,r,n){let o=this.fastMap.get(r??null);if(!o)return;let a=new I({scopeRef:e});o.addChild(a),a.parent=o,this.fastMap.set(e,a),n&&(a.nodeToRestore=n)}addNode(e){this.fastMap.set(e.scopeRef,e)}removeTreeNode(e){if(e===null)return;let r=this.fastMap.get(e);if(!r)return;let n=r.parent;for(let a of this.traverse())a!==r&&r.nodeToRestore&&a.nodeToRestore&&r.scopeRef&&r.scopeRef.current&&T(a.nodeToRestore,r.scopeRef.current)&&(a.nodeToRestore=r.nodeToRestore);let o=r.children;n&&(n.removeChild(r),o.size>0&&o.forEach(a=>n&&n.addChild(a))),this.fastMap.delete(r.scopeRef)}*traverse(e=this.root){if(e.scopeRef!=null&&(yield e),e.children.size>0)for(let r of e.children)yield*this.traverse(r)}clone(){var e;let r=new K;var n;for(let o of this.traverse())r.addTreeNode(o.scopeRef,(n=(e=o.parent)===null||e===void 0?void 0:e.scopeRef)!==null&&n!==void 0?n:null,o.nodeToRestore);return r}constructor(){this.fastMap=new Map,this.root=new I({scopeRef:null}),this.fastMap.set(null,this.root)}}class I{addChild(e){this.children.add(e),e.parent=this}removeChild(e){this.children.delete(e),e.parent=void 0}constructor(e){this.children=new Set,this.contain=!1,this.scopeRef=e.scopeRef}}let N=new K;export{de as $,fe as a,E as b,ce as c,se as d};
